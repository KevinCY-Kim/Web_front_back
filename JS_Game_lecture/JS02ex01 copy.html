<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â˜… ì§ ë§ì¶”ê¸° ê²Œì„ â˜…</title>
    <style>
        .clicked {
            background-color: yellowgreen; /* ì§ ë§ì„ ë–„ ìœ ì§€ */
            }
        .selected {
            background-color: white; /* ì„ì‹œ ì„ íƒ ìƒíƒœ */
                }
        table { 
            width: 400px;
            height: 400px;
        }
        td {
            width: 100px;
            height: 100px;
            border: 1px solid gray;
            background-color: skyblue;
        }
    </style>
</head>
<body>
    <h1>â˜… ì§ ë§ì¶”ê¸° ê²Œì„ â˜…</h1>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>
    <p>â±ï¸ê²½ê³¼ ì‹œê°„: <span id="timer">60</span>ì´ˆ</p>
    <table>
        <tr onclick="this.classList.toggle('clicked')">
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
        </tr>
        <tr onclick="this.classList.toggle('clicked')">
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
        </tr>
        <tr onclick="this.classList.toggle('clicked')">
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
        </tr>
        <tr onclick="this.classList.toggle('clicked')">
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
            <td data-ch=""><center>???</center></td>
        </tr>
    </table>

    <script>
        let timer = 0;
        let timerInterval = null;
        let gameStarted = false; 
        const cells = document.querySelectorAll('td');

        document.getElementById("startBtn").addEventListener("click", () => {
            gameStarted = true;
            initGame();
            startTimer();
        });
        // ì›ë˜ ë‹¨ì–´ë“¤ (ì§ ë§ì¶”ê¸° ìœ„í•´ 2ê°œì”©)
        const words = ["ê±°ë¶ì´","ê³ ì–‘ì´","ì˜¤ë¦¬","í­ê·„","ì‚¬ì","ë‚˜ë¹„","ë‚˜ë°©","ì‚¬ìŠ´"];
        const pairs = [...words, ...words]; // ì§ ë§ì¶”ê¸° 2ê°œì”©

        shuffle(pairs);

        console.log("pairs:", pairs.length, "cells:", cells.length);
        console.log("words:", words);      // ì—¬ê¸°ì— 8ê°œ ë‚˜ì™€ì•¼ ì •ìƒ
        console.log("pairs:", pairs);      // ì—¬ê¸°ì— 16ê°œ ë‚˜ì™€ì•¼ ì •ìƒ
        console.log("cells:", cells.length);
        
        // Fisher-yates shuffle ì•Œê³ ë¦¬ì¦˜
        function shuffle(array) {
            for (let i = array.lenth = 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        // ì„ê³  ë‚˜ì„œ <td>ì— ë°°ì¹˜
        cells.forEach((cell, index) => {
            cell.dataset.ch = pairs[index];
            cell.innerHTML = `<center>???</center>`; // ì´ˆê¸°í™”
        });

        function initGame() {
            const cells = document.querySelectorAll("td");
            shuffle(pairs);

            cells.forEach((cell, i) => {
                cell.dataset.ch = pairs[i];
                cell.innerHTML = "<center>???</center>";
                cell.className = "";

            // ì´ë²¤íŠ¸ ë“±ë¡ ë§¤ë²ˆ ìƒˆë¡œ!
            cell.onclick = () => {
                if (!gameStarted) return;

                // í´ë¦­í•˜ë©´ ë‹¨ì–´ ë³´ì—¬ì£¼ê¸°
                cell.innerHTML = `<center>${cell.dataset.ch}</center>`;
            };
        });
    }
        //ì‹œì‘ ë²„íŠ¼ ì—°ê²°
        document.getElementById("startBtn").addEventListener("click", () => {
            initGame();
            startTimer();
        });

        // íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
        function startTimer() {
            timer = 0;
            document.getElementById("timer").textContext = timer;
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById("timer").textContent = timer;
            }, 1000);
        }
        // íƒ€ì´ë¨¸ ë©ˆì¶¤ í•¨ìˆ˜
        function stopTimer() {
            clearInterval(timerterval);
        }

        const matched = document.querySelectorAll('.clicked');
        if (matched.length === cells.length) {
            stopTimer();
            gameStarted = false; // ê²Œì„ ì¢…ë£Œë¡œ í´ë¦­ ë§‰ê¸°
            alert('ğŸ‰ ê²Œì„ ë! ê²½ê³¼ ì‹œê°„: ${timer}ì´ˆ');
        }
    </script>
    <script>

        let isChecking = false; // í´ë¦­ ì¤‘ì¸ì§€ ì—¬ë¶€
        let selectedCells = [];

        cells.forEach(cell => {
            cell.addEventListener("click", () => {

                // í´ë¦­ ì°¨ë‹¨ ì¡°ê±´
                if (isChecking || cell.classList.contains("clicked") || cell.classList.contains("selected")) return;


                const value = cell.dataset.ch;
                cell.innerHTML = `<center>${value}</center>`;
                // ì…€ ì„ íƒ í‘œì‹œ
                cell.classList.add("selected");
                selectedCells.push(cell);

                // ë‘ ê°œ ì„ íƒ ì‹œ íŒë‹¨
                if (selectedCells.length === 2) {
                    isChecking = true; // í´ë¦­ ì¤‘ ìƒíƒœë¡œ ë³€ê²½

                    const [first, second] = selectedCells;
                    const firstVal = first.dataset.ch;
                    const secondVal = second.dataset.ch;

                    if (firstVal === secondVal) {
                        // ì§ì´ ë§ì•˜ì„ ë•Œ ë¨¼ì € selected ì œê±°, ê·¸ ë‹¤ìŒ .clicked ì¶”ê°€
                        setTimeout(() => {
                            [first, second].forEach(cell => {
                                cell.classList.remove("selected");
                                cell.classList.add("clicked");
                            })
                            
                            selectedCells = [];
                            isChecking = false; // í´ë¦­ ì¤‘ ìƒíƒœ í•´ì œ
                        }, 400); // 0.4ì´ˆ í›„ ìœ ì§€
                    } else {
                        // ì§ ì•ˆ ë§ìœ¼ë©´ ì›ìƒ ë³µê·€
                         setTimeout(() => {
                            [first, second].forEach(cell => {
                                cell.innerHTML = "<center>???</center>";
                                cell.classList.remove("selected", "revealed");
                            });
                            selectedCells = [];
                            isChecking = false; // í´ë¦­ ì¤‘ ìƒíƒœ í•´ì œ
                            console.log('isChecking í•´ì œë¨');
                        }, 700); // 0.7ì´ˆ í›„ ì›ìƒ ë³µê·€
        
                    }
            }
            });
        });
    </script>
</body>
</html>